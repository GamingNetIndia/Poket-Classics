<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe: AI NEON</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Audiowide&display=swap');

        :root {
            --neon-bg: #0d0221;
            --container-bg: #1d1135;
            --cell-border: #241744;
            --text-color: #f0f0f0;
            --color-x: #ff00ff; /* Neon Magenta */
            --color-o: #00ffff; /* Neon Cyan */
            --button-bg: #00ffff;
            --button-text: #0d0221;
            --win-line-color: #faff00; /* Neon Yellow */
        }

        body {
            font-family: 'Audiowide', cursive;
            background-color: var(--neon-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            color: var(--text-color);
            overflow: hidden;
        }

        /* --- Splash Screen --- */
        #splash-screen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: var(--neon-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 1s ease-out;
        }
        #splash-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        #splash-screen img {
            max-width: 80%;
            max-height: 80%;
            border-radius: 20px;
            box-shadow: 0 0 30px var(--color-x), 0 0 60px var(--color-o);
        }

        .container {
            text-align: center;
            background-color: var(--container-bg);
            padding: 30px 40px;
            border-radius: 15px;
            border: 2px solid var(--color-o);
            box-shadow: 0 0 20px var(--color-o), inset 0 0 15px rgba(0, 255, 255, 0.5);
            z-index: 10;
        }
        
        h1, h2 {
            text-shadow: 0 0 5px #fff, 0 0 15px var(--color-o);
        }
        
        #game-board {
            position: relative;
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 10px;
            margin: 20px 0;
            background-color: var(--cell-border);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.4);
        }

        .cell {
            width: 100px; height: 100px;
            background-color: var(--neon-bg);
            border-radius: 5px;
            display: flex; justify-content: center; align-items: center;
            font-size: 4em; font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .cell:not(.x):not(.o):hover { background-color: #2a1f4a; }
        
        .text-x, .cell.x { color: var(--color-x); text-shadow: 0 0 7px var(--color-x), 0 0 15px var(--color-x); }
        .text-o, .cell.o { color: var(--color-o); text-shadow: 0 0 7px var(--color-o), 0 0 15px var(--color-o); }
        
        #game-status { font-size: 1.5em; min-height: 1.5em; margin-bottom: 10px; transition: color 0.3s ease; }

        .button, .difficulty-button {
            padding: 12px 25px; font-size: 1.2em; font-family: 'Audiowide', cursive;
            color: var(--button-text); background-color: var(--button-bg);
            border: none; border-radius: 8px; cursor: pointer;
            transition: all 0.3s ease; margin: 10px 5px;
            box-shadow: 0 0 10px var(--button-bg), 0 0 20px var(--button-bg);
        }
        .button:hover, .difficulty-button:hover {
            box-shadow: 0 0 15px var(--button-bg), 0 0 30px var(--button-bg), 0 0 50px var(--button-bg);
            transform: scale(1.05);
        }
        .button-secondary {
            background-color: transparent; color: var(--color-x);
            border: 2px solid var(--color-x); box-shadow: 0 0 10px var(--color-x);
        }
        .button-secondary:hover {
            background-color: var(--color-x); color: var(--button-text);
            box-shadow: 0 0 15px var(--color-x), 0 0 30px var(--color-x);
        }
        
        #popup-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000; opacity: 0; pointer-events: none;
            transition: opacity 0.3s ease;
        }
        #popup-overlay.visible { opacity: 1; pointer-events: auto; }
        #popup {
            background-color: var(--container-bg); padding: 30px 50px;
            border-radius: 15px; border: 2px solid var(--color-x);
            box-shadow: 0 0 20px var(--color-x), inset 0 0 15px rgba(255, 0, 255, 0.5);
            transform: scale(0.9); transition: transform 0.3s ease; z-index: 1002;
        }
        #popup-overlay.visible #popup { transform: scale(1); }
        #popup-message { font-size: 2em; margin-bottom: 20px; transition: color 0.3s ease; }
        
        #win-line {
            position: absolute; background-color: var(--win-line-color);
            height: 8px; border-radius: 4px;
            box-shadow: 0 0 15px var(--win-line-color);
            transform: scaleX(0);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            pointer-events: none; z-index: 5;
        }

        #confetti-canvas {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none; z-index: 1001;
        }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="splash-screen">
        <img src="https://gamingnetindia.great-site.net/wp-content/uploads/2025/01/Logo-scaled.jpg" alt="Logo">
    </div>

    <!-- Background Music & Sound Effects (Embedded for Offline Use) -->
    <audio id="background-music" loop src="https://gamingnetindia.great-site.net/wp-content/uploads/2025/06/puzzle-loop-67641.mp3"></audio>
    <audio id="ui-sound" src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"></audio>
    <audio id="click-sound" src="data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU9vT18AAACs9f/l/f///wH//gH//gH//gH//gH//gH//gL//gL//gP//gP//gP//gP//gP//gP//gP//gP//gP//gP//gP//gP//gL//gL//gH//gH//f/9//3//f/9///8="></audio>
    <audio id="win-sound" src="data:audio/wav;base64,UklGRlAFAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAATElTVBoAAABJTkZPSVNGVAAAAA4AAABDcmVhdGlvbiB0aW1lIBAAAAAwMS8yMS8yNCAyMTozMzozMgBkYXRhgAQAAPb/5P/U/rD/OP8z/zb/Pv9C/0f/Sv9Q/1b/V/9a/13/X/9g/2L/Yv9l/2b/Zv9q/2v/b/9x/3L/cv9z/3T/c/9x/3D/c/9v/3H/c/90/3T/df92/3b/d/95/3n/ef97/3z/ev97/3v/e/98/3z/e/98/3z/e/98/3z/e/98/3v/e/97/3r/ev96/3n/d/9z/2r/Zf9c/1T/SP9B/zz/NP8r/if/Hf8Z/xb/Fv8Y/xn/G/8d/x//If8l/yz/MC8yLzMvNi83LzgvOy8+L0AvQi9FL0gvSi9NL1IvVC9YL1ovXS9fL2EvYy9mL2kvbC9uL3Avci91L3kvfS+CL4gvii+OL5EvlS+ZL58voS+rL7Evuy/BL8kvzS/UL9kv3S/iL+sv8z/4X/sf/T/+X//P8E/yH/N/9T/4H/wf/Z//r/Bv8v/2f/5P8Y/7H/EAAA/wH/Af8B/wH/Af8B/wH/Av8C/wL/Av8D/wP/A/8E/wT/BP8F/wX/Bv8G/wb/Bv8H/wf/B/8I/wj/CP8I/wj/CP8I/wj/CP8I/wj/CP8I/wj/CP8I/wj/CP8I/wf/B/8H/wf/B/8G/wb/Bv8F/wX/BP8E/wP/Av8B/wD//P/6//f/8f/p/+b/4//h/+D/4P/f/9//3v/c/9v/2f/Y/9f/1f/U/9P/0f/R/9H/0f/S/9L/0v/S/9L/0v/S/9L/0v/S/9L/0v/R/9H/0f/Q/8//zv/N/8v/yv/J/8f/wf/A/7//uv+5/7f/tP+x/6//qP+m/6T/ov+g/5//mv+X/5T/kv+Q/43/jP+L/4r/if+H/4b/hP+C/4H/f/99/3v/df9x/2n/Y/9V/0v/Q/86/yj/HP8S/wn/Af/5/uj+3P7S/s/+wv67/rf+sP6u/qj+p/6c/p/+ov6l/qr+rf6z/rj+u/68/rz+vP68/rz+u/65/rn+tf6r/qX+of6b/pL+if6D/oD+fP58/nz+fP5+/oD+gP6B/oH+gf6C/oP+hf6H/oj+iv6M/o3+jf6O/o/+kP6S/pL+k/6U/pT+lP6V/pX+lf6V/pX+lf6V/pX+lf6T/pL+kf6N/ov+iP6F/oH+fP53/mr+Yf5U/kn+QP45/in+Gf4S/gH98v25/an9o/2U/Yn9f/13/W/9Y/1T/UP9M/0n/Rv9C/z3/Of80/yz/KQAnASwBNQE+AVYBaAF5AYsBmwGjAasBswG9AcEBxwHTAdkB4AHrAf0CBQMcAzkDUQNiA38EmATKBPkFigXCBcsF5QYNBjEGWgZzBocGqwbGBuwG+gcYBy0HUAdhB34HjgehB6wHsge+B84H4wfuCAYIJwgtCDsISwhcCHoIlAiqCLYIyAjmCPwJCgk2CVYJcAl6CaQJsgm8CcwJ3gntCgAKFAooCj0KVgpoCnsKpgrMCuQK+gscCzsLXgt6C6ULvgvbDAUMGQwuDDsMUwxZDGkMggymDNMM5A0GDSYNPQ1XDWANfA2MDakNuQ3lDhAOHw4zDlMOZw6aDrYPAA8ZDyUPPg9ZD38PjA+tD8MP5RAFEBEQGRENExUXGRoaGxwdHiAhIiMkJSYnKCorLC0uLzAzNDU2Nzg5Ojw9Pj9AQUJDREVGR0hJSktMTU5PUFFSU1TVVldYWVpbXF1eX2BhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ent8fX5/gIGCg4SFhoeIiYqLjI2Oj5CRkpOUlZaXmJmam5ydnp+goaKjpKWmp6ipqqusra6vsLGys7S1tre4ubq7vL2+v8DBwsPExcbHyMnKy8zNzs/Q0dLT1NXW19jZ2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/v8AAAD/AP8A/wD/AP8A/wD/AP8A/wD/Af8B/wH/Af8B/wH/Af8B/wH/Af8B/wH/Af8B/wH/Af8B/wH/Af8B/wH/Af8B/wH/Af8B/wH/Af8B/wH/Af8B/wH/Af8B/wH/Af8B/wH/Af8A/wD/AP8A/wD//P/8//z//P/8//z//P/8//z//P/8//z//P/8//z//P/8//z//P/8//z//P/8//z//P/8//z//P/8//z//P/8//z//P/8//z//P/8//z//P/8//z//P/8//z//P/8//w="></audio>
    <audio id="draw-sound" src="data:audio/wav;base64,UklGRqACAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YfYBAAC5+v/i/dn9sf2h/Z79of2z/dX+5v7w/vL+9f7w/uX+1f6x/pr+kv6L/pX+oP6z/bz9yv3d/vL/GgEZASQBKwEyATYBOwE+AUMBRgFKAU4BUgFWAVgBWgFcAV4BYAFiAWQBZwFoAWoBawFtAW8BcgF1AXUBdQF5AXsBfQF/AYIBhQGJAYsBjQGPAZEBlQGZAZsBnwGhAaMBoQGgAZ4BmwGWgZABjQGJAYQBfQFzAW0BagFjAV8BVwFQAUcAPwEtARgA+v/k/tv+pf6S/oT+fP57/oP+jP6m/rr/wv/N/9H/0v/R/8//zf/K/8j/xP/C/8D/vv+6/7f/tP+x/6//qP+o/6f/pv+l/6T/pP+k/6T/pP+k/6T/pP+k/6T/pP+k/6T/pP+l/6X/pf+l/6X/pf+l/6X/pf+l/6X/pf+l/6T/pP+j/6L/ov+h/6D/n/+e/5v/mf+W/5X/k/+R/5D/jf+M/4r/iv+J/4j/hv+F/4T/hP+D/4L/gv+B/4D/gP9//37/fv99/3v/e/95/3f/cv9x/2z/aP9m/2L/X/9d/1v/V/9T/1L/T/9N/0r/Sv9J/0f/R/9E/0P/Qv9C/0L/Qv9C/0L/Qv9D/0P/Q/9E/0T/RP9F/0X/Rf9G/0b/Rv9H/0f/R/9I/0n/Sf9J/0n/Sf9J/0n/Sf9J/0n/Sf9J/0n/Sf9J/0n/Sf9I/0j/R/9G/0T/Qf89/zn/M/8r/yP/E/8J/wD++v7i/tL+wf6f/or+fP5x/mf+W/5L/kP+P/42/iz+Jf4c/hb+Ev4O/gr+CP4E/gD+Af4B/gL+Av4D/gT+BP4F/gX+Bf4G/gb+Bv4H/gf+B/4I/gj+CP4J/gn+Cf4K/gr+Cv4L/gv+C/4M/gz+DP4N/g3+Df4O/g7+Dv4P/g/+D/4P/g/+Dv4N/g3+DP4L/gr+Cf4G/gT+AP74/t7+y/6q/pP+g/5u/lj+S/4+/in+GP4Q/gf+9v68/qT+hf5y/lf+Q/4u/hX+Bv7v/rr+of6C/mz+T/4p/g/+7P6q/n/+Tf4k/vz+nP5j/hn+6v5w/kD+AP7W/jr/pv8d"></audio>

    <canvas id="confetti-canvas"></canvas>

    <div id="main-menu" class="container hidden">
        <h1>Tic-Tac-Toe</h1><h2>NEON FX</h2>
        <div class="button-group"><button id="vs-player-btn" class="button">VS Player</button><button id="vs-ai-btn" class="button button-secondary">VS AI</button></div>
    </div>

    <div id="difficulty-screen" class="container hidden">
        <h2>Choose Difficulty</h2>
        <div class="button-group">
            <button class="difficulty-button" data-difficulty="easy">Easy</button><button class="difficulty-button" data-difficulty="medium">Medium</button>
            <button class="difficulty-button" data-difficulty="hard">Hard</button><button class="difficulty-button" data-difficulty="expert">Expert</button>
        </div>
    </div>

    <div id="game-screen" class="container hidden">
        <div id="game-status"></div><div id="game-board"></div>
        <div class="button-group"><button id="restart-button" class="button">Restart</button><button id="back-to-menu-btn" class="button button-secondary">Main Menu</button></div>
    </div>
    
    <div id="popup-overlay">
        <div id="popup"><div id="popup-message"></div><button id="popup-restart-button" class="button">Play Again</button></div>
    </div>

    <script>
        // --- DOM & SOUND REFERENCES ---
        const splashScreen = document.querySelector('#splash-screen');
        const mainMenu = document.querySelector('#main-menu');
        const difficultyScreen = document.querySelector('#difficulty-screen');
        const gameScreen = document.querySelector('#game-screen');
        const vsPlayerBtn = document.querySelector('#vs-player-btn');
        const vsAiBtn = document.querySelector('#vs-ai-btn');
        const difficultyButtons = document.querySelectorAll('.difficulty-button');
        const statusDisplay = document.querySelector('#game-status');
        const gameBoard = document.querySelector('#game-board');
        const restartButton = document.querySelector('#restart-button');
        const backToMenuBtn = document.querySelector('#back-to-menu-btn');
        const popupOverlay = document.querySelector('#popup-overlay');
        const popupMessage = document.querySelector('#popup-message');
        const popupRestartButton = document.querySelector('#popup-restart-button');
        
        const backgroundMusic = document.querySelector('#background-music');
        const uiSound = document.querySelector('#ui-sound');
        const clickSound = document.querySelector('#click-sound');
        const winSound = document.querySelector('#win-sound');
        const drawSound = document.querySelector('#draw-sound');


        // --- GAME STATE & CONFIG ---
        let gameActive = true;
        let currentPlayer = 'X';
        let gameState = ["", "", "", "", "", "", "", "", ""];
        let gameMode = null;
        let difficulty = null;
        const humanPlayer = 'X';
        const aiPlayer = 'O';

        const winningConditions = [
            { combo: [0, 1, 2], class: 'h-top' }, { combo: [3, 4, 5], class: 'h-mid' }, { combo: [6, 7, 8], class: 'h-bot' },
            { combo: [0, 3, 6], class: 'v-left' }, { combo: [1, 4, 7], class: 'v-mid' }, { combo: [2, 5, 8], class: 'v-right' },
            { combo: [0, 4, 8], class: 'd-down' }, { combo: [2, 4, 6], class: 'd-up' }
        ];

        // --- AUDIO & SPLASH ---
        function playSound(sound) {
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(e => {}); // Catch errors if user hasn't interacted yet
            }
        }

        function playBackgroundMusic() {
            if (backgroundMusic.paused) {
                backgroundMusic.play().catch(e => console.log("User interaction needed to play audio."));
            }
        }

        window.addEventListener('load', () => {
            setTimeout(() => playBackgroundMusic(), 500);
            
            setTimeout(() => {
                splashScreen.classList.add('hidden');
                mainMenu.classList.remove('hidden');
            }, 2000); 
        });
        
        // --- EVENT LISTENERS ---
        vsPlayerBtn.addEventListener('click', () => { playSound(uiSound); playBackgroundMusic(); gameMode = 'vsPlayer'; startGame(); });
        vsAiBtn.addEventListener('click', () => { playSound(uiSound); playBackgroundMusic(); mainMenu.classList.add('hidden'); difficultyScreen.classList.remove('hidden'); });
        difficultyButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                playSound(uiSound);
                playBackgroundMusic();
                difficulty = e.target.getAttribute('data-difficulty');
                gameMode = 'vsAI';
                startGame();
            });
        });
        backToMenuBtn.addEventListener('click', () => { playSound(uiSound); playBackgroundMusic(); gameScreen.classList.add('hidden'); mainMenu.classList.remove('hidden'); resetGame(); });
        restartButton.addEventListener('click', () => { playSound(uiSound); playBackgroundMusic(); resetGame(false); });
        popupRestartButton.addEventListener('click', () => { playSound(uiSound); playBackgroundMusic(); resetGame(false); });
        
        // --- GAME FLOW ---
        function startGame() {
            mainMenu.classList.add('hidden');
            difficultyScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            resetGame(false);
        }
        function resetGame(returnToMenu = true) {
            gameActive = true; currentPlayer = 'X';
            gameState = ["", "", "", "", "", "", "", "", ""];
            updateStatus();
            document.querySelectorAll('.cell').forEach(cell => { cell.innerHTML = ""; cell.classList.remove('x', 'o'); });
            const winLine = document.getElementById('win-line'); if(winLine) winLine.style.cssText = 'transform: scaleX(0);';
            popupOverlay.classList.remove('visible');
            clearConfetti();
            if (returnToMenu) {
                gameScreen.classList.add('hidden'); mainMenu.classList.remove('hidden'); gameMode = null; difficulty = null;
            }
        }
        function updateStatus() {
            statusDisplay.classList.remove('text-x', 'text-o');
            if (gameMode === 'vsAI' && currentPlayer === aiPlayer && gameActive) {
                statusDisplay.innerHTML = 'AI is thinking...';
            } else {
                statusDisplay.innerHTML = `Player ${currentPlayer}'s turn`;
                statusDisplay.classList.add(currentPlayer === 'X' ? 'text-x' : 'text-o');
            }
        }

        // --- MAIN GAME LOGIC ---
        function handleCellClick(e) {
            const clickedCellIndex = parseInt(e.target.getAttribute('data-cell-index'));
            if (gameState[clickedCellIndex] !== "" || !gameActive || (gameMode === 'vsAI' && currentPlayer === aiPlayer)) return;
            placeMark(clickedCellIndex);
        }
        function placeMark(index, player = currentPlayer) {
            if (gameState[index] !== "" || !gameActive) return;
            playSound(clickSound);
            gameState[index] = player;
            document.querySelector(`[data-cell-index='${index}']`).innerHTML = player;
            document.querySelector(`[data-cell-index='${index}']`).classList.add(player.toLowerCase());
            handleResultValidation();
        }
        function handleResultValidation() {
            let roundWon = false; let winningComboInfo = null;
            for (let i = 0; i < winningConditions.length; i++) {
                if (winningConditions[i].combo.every(index => gameState[index] === currentPlayer)) {
                    roundWon = true; winningComboInfo = winningConditions[i]; break;
                }
            }
            if (roundWon) { endGame(false, winningComboInfo); return; }
            if (!gameState.includes("")) { endGame(true); return; }
            switchPlayer();
        }
        function switchPlayer() {
            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            updateStatus();
            if (gameMode === 'vsAI' && currentPlayer === aiPlayer && gameActive) { setTimeout(makeAIMove, 700); }
        }
        function endGame(isDraw, winningComboInfo) {
            gameActive = false;
            popupMessage.classList.remove('text-x', 'text-o');
            if (isDraw) { 
                playSound(drawSound);
                showPopup("It's a Draw!"); 
            } else {
                playSound(winSound);
                drawWinLine(winningComboInfo.class);
                setTimeout(() => {
                    let winnerName = (currentPlayer === humanPlayer) ? 'Player X' : 'The AI';
                    if (gameMode === 'vsPlayer') winnerName = `Player ${currentPlayer}`;
                    
                    popupMessage.classList.add(currentPlayer === 'X' ? 'text-x' : 'text-o');
                    showPopup(`${winnerName} Wins!`);
                    triggerConfetti();
                }, 600);
            }
        }
        
        // --- ACCURATE WIN LINE ---
        function drawWinLine(winClass) {
            const winLine = document.getElementById('win-line');
            winLine.style.transformOrigin = 'center center';
            const lineLength = '320px';
            const diagLength = '440px'; 
            
            switch (winClass) {
                case 'h-top':   winLine.style.cssText = `width: ${lineLength}; top: 60px; left: 10px; transform: scaleX(1); transform-origin: left;`; break;
                case 'h-mid':   winLine.style.cssText = `width: ${lineLength}; top: 170px; left: 10px; transform: scaleX(1); transform-origin: left;`; break;
                case 'h-bot':   winLine.style.cssText = `width: ${lineLength}; top: 280px; left: 10px; transform: scaleX(1); transform-origin: left;`; break;
                case 'v-left':  winLine.style.cssText = `width: ${lineLength}; top: 170px; left: -100px; transform: rotate(90deg) scaleX(1);`; break;
                case 'v-mid':   winLine.style.cssText = `width: ${lineLength}; top: 170px; left: 10px; transform: rotate(90deg) scaleX(1);`; break;
                case 'v-right': winLine.style.cssText = `width: ${lineLength}; top: 170px; left: 120px; transform: rotate(90deg) scaleX(1);`; break;
                case 'd-down':  winLine.style.cssText = `width: ${diagLength}; top: 170px; left: -50px; transform: rotate(45deg) scaleX(1);`; break;
                case 'd-up':    winLine.style.cssText = `width: ${diagLength}; top: 170px; left: -50px; transform: rotate(-45deg) scaleX(1);`; break;
            }
        }
        
        // --- AI LOGIC ---
        function makeAIMove() { if (!gameActive) return; let move; switch (difficulty) { case 'easy': move = findEasyMove(); break; case 'medium': move = findMediumMove(); break; case 'hard': move = findHardMove(); break; case 'expert': move = findExpertMove(); break; } placeMark(move, aiPlayer); }
        function getAvailableCells() { return gameState.map((c, i) => c === "" ? i : null).filter(v => v !== null); }
        function findEasyMove() { const a = getAvailableCells(); return a[Math.floor(Math.random() * a.length)]; }
        function findMediumMove() { for (const c of getAvailableCells()) { let t = [...gameState]; t[c] = aiPlayer; if (checkWinner(t, aiPlayer)) return c; } for (const c of getAvailableCells()) { let t = [...gameState]; t[c] = humanPlayer; if (checkWinner(t, humanPlayer)) return c; } return findEasyMove(); }
        function findHardMove() { for(const c of getAvailableCells()){let t=[...gameState]; t[c]=aiPlayer; if(checkWinner(t,aiPlayer)) return c;} for(const c of getAvailableCells()){let t=[...gameState]; t[c]=humanPlayer; if(checkWinner(t,humanPlayer)) return c;} if (gameState[4] === "") return 4; const corners = [0, 2, 6, 8].filter(c => gameState[c] === ""); if (corners.length > 0) return corners[Math.floor(Math.random() * corners.length)]; return findEasyMove(); }
        function findExpertMove() { return minimax(gameState, aiPlayer).index; }
        function minimax(newBoard, player) {
            let availSpots = newBoard.map((c, i) => c === "" ? i : null).filter(v => v !== null);
            if (checkWinner(newBoard, humanPlayer)) return { score: -10 }; else if (checkWinner(newBoard, aiPlayer)) return { score: 10 }; else if (availSpots.length === 0) return { score: 0 };
            let moves = [];
            for (let i = 0; i < availSpots.length; i++) { let move = {}; move.index = availSpots[i]; newBoard[availSpots[i]] = player;
                if (player === aiPlayer) { move.score = minimax(newBoard, humanPlayer).score; } else { move.score = minimax(newBoard, aiPlayer).score; }
                newBoard[availSpots[i]] = ""; moves.push(move);
            }
            let bestMove;
            if (player === aiPlayer) { let bestScore = -10000; for (let i = 0; i < moves.length; i++) { if (moves[i].score > bestScore) { bestScore = moves[i].score; bestMove = i; } } }
            else { let bestScore = 10000; for (let i = 0; i < moves.length; i++) { if (moves[i].score < bestScore) { bestScore = moves[i].score; bestMove = i; } } }
            return moves[bestMove];
        }
        function checkWinner(board, player) { for (const c of winningConditions) { if (c.combo.every(i => board[i] === player)) return true; } return false; }
        
        // --- UI & FX LOGIC ---
        function showPopup(message) { popupMessage.innerHTML = message; popupOverlay.classList.add('visible'); }
        function initializeBoard() { gameBoard.innerHTML = '<div id="win-line"></div>'; for (let i = 0; i < 9; i++) { const cell = document.createElement('div'); cell.classList.add('cell'); cell.setAttribute('data-cell-index', i); cell.addEventListener('click', handleCellClick); gameBoard.appendChild(cell); } }
        const canvas = document.getElementById('confetti-canvas'); const ctx = canvas.getContext('2d'); let particles = []; const confettiColors = ['#ff00ff', '#00ffff', '#faff00', '#39ff14', '#f721ff', '#ff5500'];
        function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        function Particle(x, y, color) { this.x = x; this.y = y; this.color = color; this.radius = Math.random() * 6 + 1; this.vx = (Math.random() - 0.5) * 10; this.vy = (Math.random() - 0.5) * 10 - 12; this.gravity = 0.3; this.opacity = 1; this.fade = 0.015; }
        Particle.prototype.update = function() { this.vy += this.gravity; this.x += this.vx; this.y += this.vy; this.opacity -= this.fade; };
        Particle.prototype.draw = function() { ctx.globalAlpha = this.opacity; ctx.beginPath(); ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false); ctx.fillStyle = this.color; ctx.shadowColor = this.color; ctx.shadowBlur = 10; ctx.fill(); ctx.closePath(); ctx.shadowBlur = 0; };
        function triggerConfetti() { for (let i = 0; i < 150; i++) { const color = confettiColors[Math.floor(Math.random() * confettiColors.length)]; particles.push(new Particle(canvas.width / 2, canvas.height / 2 + 50, color)); } }
        function animateConfetti() { ctx.clearRect(0, 0, canvas.width, canvas.height); particles.forEach((p, index) => { if (p.opacity > 0) { p.update(); p.draw(); } else { particles.splice(index, 1); } }); requestAnimationFrame(animateConfetti); }
        function clearConfetti() { particles = []; }
        window.addEventListener('resize', resizeCanvas);
        initializeBoard(); resizeCanvas(); animateConfetti();
    </script>
</body>
</html>